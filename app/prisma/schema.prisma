generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id            String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name          String
  domain        String          @unique
  description   String?
  industry      String?
  size          String?
  location      String?
  linkedinUrl   String?
  websiteUrl    String?
  createdAt     DateTime?       @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime?       @default(now()) @db.Timestamptz(6)
  Contact       Contact[]
  Job           Job[]
  OutreachBatch OutreachBatch[]

  @@index([domain], map: "idx_company_domain")
}

model Contact {
  id              String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  companyId       String?         @db.Uuid
  batchId         String?         @db.Uuid
  apolloId        String?
  fullName        String
  firstName       String?
  lastName        String?
  title           String?
  department      String?
  seniority       String?
  email           String
  emailStatus     String?
  emailConfidence Decimal?        @db.Decimal(3, 2)
  linkedinUrl     String?
  photoUrl        String?
  headline        String?
  location        String?
  researchSummary String?
  source          String?         @default("apollo")
  verifiedAt      DateTime?       @db.Timestamptz(6)
  createdAt       DateTime?       @default(now()) @db.Timestamptz(6)
  updatedAt       DateTime?       @default(now()) @db.Timestamptz(6)
  OutreachBatch   OutreachBatch?  @relation(fields: [batchId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  Company         Company?        @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  OutreachEmail   OutreachEmail[]

  @@unique([email, companyId])
  @@index([batchId], map: "idx_contact_batch")
  @@index([email], map: "idx_contact_email")
}

model Job {
  id            String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  companyId     String?         @db.Uuid
  title         String
  description   String?
  jobUrl        String?
  location      String?
  type          String?
  salary        String?
  requirements  String?
  status        String?         @default("active")
  postedAt      DateTime?       @db.Timestamptz(6)
  createdAt     DateTime?       @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime?       @default(now()) @db.Timestamptz(6)
  Company       Company?        @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  OutreachBatch OutreachBatch[]

  @@index([companyId], map: "idx_job_company")
}

model OutreachBatch {
  id                 String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  jobId              String?         @db.Uuid
  companyId          String?         @db.Uuid
  status             String?         @default("pending")
  currentStep        String?
  progress           Int?            @default(0)
  totalContactsFound Int?            @default(0)
  totalEmailsDrafted Int?            @default(0)
  errorMessage       String?
  startedAt          DateTime?       @db.Timestamptz(6)
  completedAt        DateTime?       @db.Timestamptz(6)
  createdAt          DateTime?       @default(now()) @db.Timestamptz(6)
  updatedAt          DateTime?       @default(now()) @db.Timestamptz(6)
  Contact            Contact[]
  Company            Company?        @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  Job                Job?            @relation(fields: [jobId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  OutreachEmail      OutreachEmail[]

  @@index([jobId], map: "idx_batch_job")
  @@index([status], map: "idx_batch_status")
}

model OutreachEmail {
  id               String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  contactId        String?        @db.Uuid
  batchId          String?        @db.Uuid
  subject          String
  body             String
  personalizations Json?
  aiGeneratedBy    String?
  status           String?        @default("draft")
  sentAt           DateTime?      @db.Timestamptz(6)
  openedAt         DateTime?      @db.Timestamptz(6)
  repliedAt        DateTime?      @db.Timestamptz(6)
  createdAt        DateTime?      @default(now()) @db.Timestamptz(6)
  updatedAt        DateTime?      @default(now()) @db.Timestamptz(6)
  OutreachBatch    OutreachBatch? @relation(fields: [batchId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  Contact          Contact?       @relation(fields: [contactId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([contactId], map: "idx_email_contact")
  @@index([status], map: "idx_email_status")
}
